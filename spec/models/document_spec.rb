require 'rails_helper'

content1 = "xX



Hk







COUNCIL CONSEIL
OF EUROPE



Strasbourg, 15 January 2014 ECRML (2014) 1





EUROPEAN CHARTER FOR REGIONAL OR MINORITY LANGUAGES



APPLICATION OF THE CHARTER IN THE UNITED KINGDOM
monitoring cycle

A. Report of the Committee of Experts on the Charter

B. Recommendation of the Committee of Ministers of the
Council of Europe on the application of the Charter by the
United Kingdom






The European Charter for Regional or Minority Languages provides for a control mechanism to evaluate how
the Charter is applied in a State Party with a view to, where necessary, making recommendations for
improving its language legislation, policy and practices. The central element of this procedure is the
Committee of Experts, set up under Article 17 of the Charter. Its principal purpose is to report to the
Committee of Ministers on its evaluation of compliance by a Party with its undertakings, to examine the real
situation of regional or minority languages in the State and, where appropriate, to encourage the Party to
gradually reach a higher level of commitment.

To facilitate this task, the Committee of Ministers adopted, in accordance with Article 15, paragraph1, an
outline for periodical reports that a Party is required to submit to the Secretary General. The report should be
made public by the State. This outline requires the State to give an account of the concrete application of the
Charter, the general policy for the languages protected under Part Il and, in more precise terms, all
measures that have been taken in application of the provisions chosen for each language protected under
Part Ill of the Charter. The Committee of Experts  first task is therefore to examine the information contained
in the periodical report for all the relevant regional or minority languages on the territory of the State
concerned.

The Committee of Experts  role is to evaluate the existing legal acts, regulations and real practice applied in
each State for its regional or minority languages. It has established its working methods accordingly. The
Committee of Experts gathers information from the respective authorities and from independent sources
within the State, so as to attempt to obtain a fair and just overview of the real language situation. After a
preliminary examination of an initial periodical report, the Committee of Experts submits, if necessary, a
number of questions to each Party to obtain supplementary information from the authorities on matters it
considers insufficiently developed in the report itself. This written procedure is usually followed up by an on-
the-spot visit by a delegation of the Committee of Experts to the State in question. During this visit the
delegation meets bodies and associations whose work is closely related to the use of the relevant
languages, and consults the authorities on matters that have been brought to its attention. This information-
gathering process is designed to enable the Committee of Experts to evaluate more effectively the
application of the Charter in the State concerned.

Having concluded this process, the Committee of Experts adopts its own report. This report is submitted to
the Committee of Ministers, together with suggestions for recommendations that the latter may decide to
address to the State Party.




Contents

A. Chapter 1

Chapter 2

Chapter 3

Chapter 4

Report of the Committee of Experts on the application of the Charter in

the United Kingdom 4
Background 4
1.1. Ratification of the Charter by the United 4
1.2. Presentation of the regional or minority language situation in the United Kingdom:

UPC ALC cece cece cette ee ee reer terre ee 4
1.3. Particular issues arising in the evaluation of the application of the Charter in the United
KIN QOOM ee etree rete eens ee ee tees cee ae ae ae een 5

Conclusions of the Committee of Experts on how the State authorities
have reacted to the recommendations of the Committee of Ministers

7
The Committee of Experts  evaluation in respect of Parts II and Ill of the
Carter 8
3.1. Evaluation in respect of Part Il of the Charter 8
3.2. Evaluation in respect of Part Ill of the Charter 16
3.2.1. The WelSh ee 16
3.2.2. The SCottish-GaeliC 23
3.2.3. The IANQUAQGE nee 29
Findings of the Committee of Experts in the fourth monitoring 36
Appendix I: Instrument of Ratification 38
Appendix Il: Comments from the UK 41

Recommendation of the Committee of Ministers of the Council of Europe
on the application of the Charter by the United 45
A. Report of the Committee of Experts on the application of the Charter in the
United Kingdom

adopted by the Committee of Experts on 21 June 2013
and presented to the Committee of Ministers of the Council of Europe
in accordance with Article 16 of the Charter

Chapter 1 Background information

1.1. Ratification of the Charter by the United Kingdom

1. The United Kingdom signed the European Charter for Regional or Minority Languages (hereafter
referred to as  the Charter ) on 2 March 2000, and ratified it on 27 March 2001. It entered into force on
1 July 2001. The instrument of ratification and subsequent declarations are set out in Appendix of this
report.

2. The authorities of the United Kingdom presented their fourth periodical report to the Secretary
General of the Council of Europe on 11 March 2013, 10 months after it was due. This is the second time that
the UK authorities submitted the periodical report after a substantial delay. In addition the report is
incomplete, lacking information about the situation in Northern Ireland. The delay has hampered the process
of timely and effective application of charter provisions throughout the UK.

3. This fourth evaluation report is based on the information obtained by the Committee of Experts from
the fourth periodical report of the UK as well as through meetings held with representatives of speakers of
regional or minority languages in the UK and the UK authorities during the on-the-spot visit, which took place
from 29 April to 2 May 2013. The Committee of Experts also received an extensive number of comments
from bodies and associations legally established in the UK, submitted pursuant to Article 16 paragraph 2 of
the Charter. This information was very helpful in the course of evaluating the application of the Charter and
the Committee of Experts would like to express its appreciation to these organisations for their valuable
contribution and participation in the monitoring process.

4. The present report contains detailed observations which the UK authorities are encouraged to take
into account when developing their policy on regional or minority languages. On the basis of these detailed
observations, the Committee of Experts has also established a list of general proposals for the preparation of
a fourth set of recommendations to be addressed to the UK by the Committee of Ministers, as provided in
Article 16, paragraph 4 of the Charter.

5. This present fourth report was adopted by the Committee of Experts on 21 June 2013.
1.2. Presentation of the regional or minority language situation in the United Kingdom: update

6. The Committee of Experts refers to the relevant paragraphs of the first, second and third evaluation
reports  for basic information on the situation of regional or minority languages in the UK. The regional or
minority languages covered under the Charter in the UK are Welsh, Scottish Gaelic, Irish, Scots, Ulster Scots
and Cornish. Manx Gaelic in the Isle of Man is also covered under the Charter. Welsh, Scottish Gaelic and
Irish have been granted protection under Part Ill of the Charter, as stated in the instrument of ratification.

7. New developments will be dealt with under Part II and Part Ill, wnere appropriate. The results of the
2011 census concerning the number of speakers of regional or minority languages in the UK are partly
known. There is information on the census results in Wales, but not for the other languages included in the
census.  In the 2011 census, 19% (562,000) of Welsh residents aged three and over reported being able to
speak Welsh, while in the 2001 Census 20.8% of the population (582,000) had reported being able to speak
Welsh. Although the overall decline is not great, there have been worrying falls in numbers of speakers in the



First evaluation report of the Committee of Experts on the application of the European Charter for Regional or Minority Languages in
the United Kingdom, ECRML (2004) 1 Second evaluation report on the application of the European Charter for Regional or Minority
Languages in the United Kingdom, ECRML (2007) 2. Third evaluation report on the application of the European Charter for Regional or
Minority Languages in the United Kingdom, ECRML (2010) 4.





4
traditionally strong areas of North and West Wales, with two counties (Ceredigion and Carmarthenshire)
becoming less than 50% Welsh-speaking for the first time in history.

Cornish

8. At the time of the last report, the Cornish Language Partnership (CLP) had commissioned a survey
of speakers which gave a figure of 699 speakers at three levels of competency. The survey did not claim to
capture all speakers but to provide a baseline. The CLP survey is not due to be updated until 2013, but the
Partnership continues to monitor numbers in classes and the number taking and passing examinations in the
language. These statistics show a steady but modest increase.

Scots

9. In its second evaluation report, the Committee of Experts noted that there was only an estimate of
the number of speakers of Scots and stressed the need for an assessment of the number of speakers as an
essential basis for developing a comprehensive language policy. In the fourth periodical report the United
Kingdom authorities stated that detailed information based on the 2011 census is not yet available.

1.3. Particular issues arising in the evaluation of the application of the Charter in the United
Kingdom

10. As mentioned in the first evaluation report, the responsibility for the practical implementation of the
Charter lies within the devolved administrations, with the exception of the Cornish language and those
undertakings that lie directly within the competence of the central authorities. The UK Government
nevertheless has the final responsibility under international law for the implementation of the Charter. During
the on-the-spot visit the Cornish Language Partnership drew the attention of the Committee of Experts to the
lack of engagement of the UK Government concerning the development of the Cornish language. The UK
Government does not introduce measures to promote the Cornish language nor remove barriers to progress.

11. Apart from Northern Ireland (see paragraph 12), the Committee of Experts notes that the fourth
periodical report is more coherent and informative and deals with most of the relevant issues that had been
raised in the previous monitoring round. The fourth periodical report provides more targeted information
related to questions raised by the Committee of Experts in the framework of the third evaluation report.

12. Information about Irish and Ulster Scots in the fourth periodical report is still confined to those areas
which remain the sole competence of the UK Government in London. Areas which have been devolved to
Northern Ireland are not included. It was explained to the Committee of Experts that the responsibility for
preparing these relevant parts of the report was that of the Northern Ireland power-sharing Executive.
According to the authorities it was again not possible to agree within the Executive on the relevant text to be
included in the report. The Committee of Experts regrets that the periodical report does not include important
information relating to one Part Ill and one Part II language. It reminds the UK Government that it is its duty
under the Charter to submit a complete report on time and expects that the forthcoming report will comply in
full with Article 15 of the Charter.





The Committee of Experts strongly urges the UK authorities to comply with their obligation to report
on the application of the Charter in accordance with Article 15 of the Charter.



13. The devolution settlement in Northern Ireland presents obstacles to the promotion and the protection
of regional or minority languages to the extent that there is no political consensus on the contribution to be
made by the Northern Ireland Government. The responsibility of competence with regard to regional or
minority languages was devolved to the Northern Ireland Assembly. Nevertheless, no legislation promoting
the Irish language has been adopted. The Committee of Experts was informed that this is because of the
need to obtain consensus within the power sharing administration.

14. The Committee of Experts is of the opinion that legislation is needed for the protection of the Irish
language.





The Committee of Experts strongly urges the authorities to provide an appropriate legislative base
for the protection and promotion of Irish in Northern Ireland.



15. During the on-the-spot visit the Committee of Experts observed that amongst speakers there was a
spirit of mutual understanding between those wishing to promote the Irish language and the promotion of
Ulster Scots. There was a realisation that the situation and needs of the two languages were different. The




Committee of Experts was particularly encouraged by initiatives taken by the Minister for the Department of
Culture, Arts and Leisure (DCAL) to bring the two language communities together. This spirit of mutual
tolerance and understanding appears to the Committee of Experts to be a valuable platform on which to
build a political consensus.
Chapter 2 Conclusions of the Committee of Experts on how the State authorities
have reacted to the recommendations of the Committee of Ministers
(RecChL(2010)4)

Recommendation No.1:

 continue to take resolute action for the protection and promotion of Scottish Gaelic in all areas, and in
particular strengthen Scottish Gaelic education, especially through the training of teachers and the
production of teaching and learning materials;

16. Efforts to promote the Scottish Gaelic language continue, with considerable support and goodwill
from the Scottish Executive. The development of the television channel BBC Alba has, in particular, been a
success. Nevertheless, in the field of education considerable practical difficulties remain. There have been
initiatives in relation to teacher training and teaching materials, but there is still a serious shortage of
teachers, and there is a need for further resolute action in this area.

Recommendation No.2:

 adopt and implement a comprehensive Irish language policy, preferably through the adoption of legislation .
17. No steps have been taken to implement this recommendation. Promotion of the Irish language
remains, regrettably, a highly contentious issue in Northern Ireland.

Recommendation No.3:

 ensure that health and social care facilities offer services in Welsh .

18. Following consultations with interested parties during 2010 the Welsh Government decided to
develop a strategic framework to strengthen Welsh language provision within health and social services. The
framework was published in November 2012 and it confirmed the Government's commitment to strengthen
Welsh language services to service users and their families with the focus of the work being on developing
front line services. Notwithstanding these positive developments, there remains considerable concern about
the situation on the ground, and the Welsh Language Commissioner has launched a statutory investigation
into the whole question on the use of Welsh in health and social services.

Recommendation No.4:

 adopt a strategy to enhance and develop Ulster Scots, in co-operation with the speakers .

19. The position of Ulster Scots has improved since the previous monitoring round, thanks largely to the

work of Tha Boord Ulst r-Scotch (Ulster-Scots Agency), which has had a proactive role in developing a
strategy for Ulster Scots, based on firm language planning grounds.
Chapter 3 The Committee of Experts  evaluation in respect of Parts Il and Ill of the
Charter

3.1. Evaluation in respect of Part Il of the Charter

20. The Committee of Experts will not comment on those provisions of Part II for which no major issues
were raised in the third evaluation report and for which the Committee of Experts has not received any new
significant information. Under Part Il, this concerns Article 7, paragraph 5. The Committee of Experts
reserves, however, the right to evaluate the implementation of this provision again at a later stage.

Article 7 - Objectives and principles

Paragraph 1

In respect of regional or minority languages, within the territories in which such languages are used and according to the
situation of each language, the Parties shall base their policies, legislation and practice on the following objectives and
principles:

a. the recognition of the regional or minority languages as an expression of cultural wealth;

Cornish

21. According to the fourth periodical report, the Cornwall County Council has a policy in place which
recognises the distinctiveness of Cornwall and the place of the language in contemporary culture and
heritage and undertakes to provide information on the language and supports development initiatives. Work
undertaken by the Cornish Language Partnership in schools aims to place the language in a cultural and
historical context, and resources produced draw on historic and contemporary culture for their frame of
reference.

Manx Gaelic

22. According to the fourth periodical report, in 2012 the Manx Heritage Foundation s Manx Language
Development Officer produced an updated review for the language. It is hoped that key partners will meet on
a regular basis to implement a long-term strategy for Manx Gaelic.

Scots

23. In the course of the third monitoring round, the Committee of Experts had noted a stronger
recognition of the Scots language. Since then, further positive developments can be noted. In the fourth
periodical report, the authorities mention the first Government-funded research into public attitudes to the
Scots language which can be seen as being recognition of the language's importance to contemporary
Scotland. The digitalisation and cataloguing of recordings from all over Scotland were also mentioned.

Scottish Gaelic

24. According to the fourth periodical report, 46 public bodies have been given notification from Bord na
Gaidhlig to prepare a Gaelic Language Plan. The Bord s Gaelic Usage Committee will take the lead in
creating strong links between the National Plan and each authority s Gaelic Language Plan. In the last state
report, the authorities mention the realisation of a study called  Public Attitude towards the Gaelic Language
which can be interpreted as recognition of the language's importance to contemporary Scotland. They also
mention the digitalisation and cataloguing of recordings from all over Scotland.

Irish

25. During the on-the-spot visit, the Committee of Experts was informed by the DCAL, that it supports an
Irish Language Act and that there are proposals for an Irish Language Bill. However, these proposals have
not led to any concrete results as yet.

b. the respect of the geographical area of each regional or minority language in order to ensure that existing or
new administrative divisions do not constitute an obstacle to the promotion of the regional or minority
language in question;

Cornish

26. According to the fourth periodical report, following the establishment of the unitary authority, Cornwall
Council accepted the role of a lead partner and accountable body and provided representation from each of
the political groupings on the council. The administrative borders of Cornwall remain the same as those for
the previous County Council.
27. During the on-the-spot visit, the Committee of Experts met with the Cornish Language Partnership
which generally viewed the structural change positively, since it strengthens the position of Cornish.
However, the Partnership deplored the limited financial support provided by UK authorities which is
inadequate to effectively reverse the language shift in respect of a critically endangered language such as
Cornish.

Irish

28. During the previous monitoring cycles, the Committee of Experts was informed of a plan to reduce
the number of 26 district councils in Northern Ireland. Some councils with a favourable Irish language policy
were concerned that merging into a larger council may diminish the favourable promotion of Irish. The fourth
periodical report does not make any mention of this issue.

29. During the on-the-spot visit, the Committee of Experts was informed that on 22 April 2013 the
transfer of powers to local councils was agreed. This will enable the transfer of a package of functions to the
11 new councils from central government departments in April 2015. The package, which will also give the
new councils more wide-ranging powers and responsibilities, has now been agreed by the Executive.
Powers will transfer in planning, road, urban regeneration, community development, housing, local economic
development and local tourism.

30. NGOs expressed their concerns to the Committee of Experts that the changing of local council areas
and amalgamating of some councils with others is likely to impact on Irish language provisions and policies,
including in the existing council areas where Irish Language Officers are currently employed.

31. The Committee of Experts therefore reiterates its concern and urges the authorities to ensure that
the new administrative divisions will not be less favourable to the existing minority language protection.

Welsh

32. Representatives of Welsh speakers explained that new legislation (The Local Government (Wales)
Measure 2011) gave the Welsh government the power to enforce the amalgamation of councils. They
expressed concern that changes could jeopardise the use of Welsh.

(o7 the need for resolute action to promote regional or minority languages in order to safeguard them;

Cornish

33. According to the fourth periodical report, action has been guided by the Cornish Language
Development Strategy, adopted in 2005, which was endorsed by the UK Government as providing the
framework for implementing Part Il of the Charter. In 2008, the government renewed and increased its
financial support and Cornwall Council renewed support, with additional in-kind support through the hosting
of the Partnership office and staff. In 2011 government funding was renewed on a tapering basis of annual
payments of  140,000,  120,000 and  100,000 with the proviso that central funding may cease after that
date. This decision was taken in light of the need to find savings in public expenditure to address the deficit.

34. The Committee of Experts is concerned that the abolishment of the central government s funding
might severely hamper the protection and promotion of Cornish. It encourages the UK authorities to engage
in a constructive dialogue with the Cornish Language Partnership in order to review the financial
contributions provided in light of the needs presented by the representatives of the Cornish language
community.

Irish

35. During the on-the-spot visit, the Committee of Experts was informed by the Minister of the DCAL,
that, under the current monitoring round, draft proposals for a strategy for the Irish language and a separate
strategy for Ulster Scots were put out for public consultation. The strategy will require cross-party support
from the Northern Ireland Executive and Assembly before it can be adopted.

Scots

36. In the fourth periodical report, the authorities mention that the Scots Language Working Group was
set up to advise Ministers on the profile and needs of the Scots language. The Group published its report
and recommendations, setting out proposals to enhance the status of Scots and promote the use of all its
dialects. The work of the Group focused on sectors that have the potential to increase the use and status of
Scots, including education, broadcasting, publishing, literature and the arts.
37. During the on-the-spot visit, the Committee of Experts was informed that mainstreaming the Scots
language in literature classes has been promoted successfully.

Scottish Gaelic

38. During the on-the-spot visit, the Committee of Experts was informed of increased interaction at local
level to provide for improved exchange of information and pooling of existing resources between local
authorities in connection with the promotion of Gaelic.

Ulster Scots

39. As well as the strategy mentioned at paragraph 35 above, there have been positive developments for
Ulster Scots. During the on-the-spot visit, the Committee of Experts was impressed by the work done by Tha
Boord Ulster-Scotch (Ulster-Scots Agency) to broaden the acceptance and the use of Ulster-Scots in
everyday life. The NGO representatives flagged the need for qualified teachers in order to be able to
revitalise Ulster-Scots within mainstream society in Northern Ireland.

Welsh

40. In December 2010, the National Assembly of Wales approved the Welsh Government-proposed
Welsh Language (Wales) Measure, which became law in February 2011. A new Welsh Language Strategy
as well as a new Welsh-medium Education Strategy were published in the course of the fourth monitoring
round. The Measure provided official status for Welsh in Wales and created an entirely new regime for the
use of Welsh by public authorities and others responsible for delivering services to the public. The Welsh
Language Board was abolished, and in its place the office of the Welsh Language Commissioner
Gymraeg) was established. Under the Measure, an elaborate process has been created,
under which the Welsh Ministers can create Welsh Language Standards, which the Commissioner is then
able to impose on public authorities and others. Standards can cover not only the use of Welsh in the
delivery of services, but also in the development of policy. For the Welsh Government and Local Authorities,
standards can include obligations about promoting the Welsh language. The Commissioner has powers to
investigate any breach of standards and to impose sanctions for breach. There is currently an impasse,
since the Welsh Ministers have rejected draft standards proposed by the Commissioner, but the Welsh
Government anticipates that the standards will be in force by November 2014.

41. In the meantime, the statutory language schemes previously monitored by the Welsh Language
Board remain in force, and are monitored by the Commissioner. As bodies which now have such schemes
become subject to binding standards, their schemes fall away. The Measure also gives the Commissioner
various powers relating to the Welsh language which are similar to the promotion and advisory powers of the
Welsh Language Board, and additional powers to conduct inquiries and investigations, including a specific
power to investigate restrictions on the freedom to use Welsh. Most of the Board s previous functions in
respect of promoting the Welsh language through funding) are however now being exercised by the
Welsh Government directly.

d. the facilitation and/or encouragement of the use of regional or minority languages, in speech and writing, in
public and private life;

42. The Committee of Experts will deal with the situation of Welsh, Scottish Gaelic and Irish under the
relevant undertakings of Part below.

Cornish
43. The fourth periodical report lists a range of ways in which the use of the Cornish language has been
encouraged and facilitated in public life.

44. The CLP makes intensive use of social media, including both Facebook and Twitter, to disseminate
information and engender interest. Moreover, a number of projects have been organised which highlight
Cornish and place it in a cultural context.

45. New learning resources have been produced by the Partnership including a follow-up publication to
the Key Stage One resources identified in the last report. Activity packs for schools have been produced,
based around Christmas, St Piran s Day and Cornish Drama, while the language organisations continue to
produce a range of publications for all levels of ability.

46. As for the media, the BBC continues to provide a 5-minute news bulletin in Cornish. A series for

learners consisting of twelve 5-minute programmes has been produced by the CLP in association with My
Cornwall TV and released as a DVD. A second series has been prepared and is currently being broadcast.

10
Radio an Gernewegva, a web-based provider dependent on voluntary effort, produces half an hour of
reporting and music in Cornish each week. Discussions with community radio stations are under way with
the aim of producing some content in the near future.

Manx Gaelic

47. According to the fourth periodical report, Manx Radio, partly funded by the government, provides two
weekly programmes in Manx Gaelic and three other weekly programmes that are partly in Manx Gaelic and
partly in English. In addition, selected Manx Radio news items are translated into Manx once a week and are
made available as text and as sound files on the Manx Radio website.

48. The authorities also mentioned in their report that the Members of the Isle of Man s parliament,
Tynwald, are permitted to use relevant customary words and phrases in Manx Gaelic, provided that the
meaning of those words or phrases is either well understood or the Member provides a translation into
English if requested to so do by the presiding officer. A significant number of the Members of Tynwald do
now use such words and phrases in Manx Gaelic during parliamentary proceedings.

49. The Manx Heritage Foundation continues to support the use of the Manx language. It has an
integrated social me"

content2 = "dia presence (website, YouTube channel, twitter feed) and, in November 2012, it
launched a Manx Gaelic application for smartphones and tablets. It continues to produce material in Manx
for both adult and young readers and, in conjunction with yn Cheshaght Ghailckagh, runs a Manx Language
week in the autumn which includes lectures and social events in the language. It also has a programme of
digitalisation of archives, records and other resources. And the Coonceil ny Gaelgey, which operates as a
sub-committee of the Manx Heritage Foundation, continues to provide authoritative Manx versions of the
titles of Government Departments, street names etc. and the creation of new words and phrases in Manx
Gaelic. These terms are available at: This website has been upgraded in recent years
so that it now provides a comprehensive resource for users of the language."

RSpec.describe Document, type: :model do

  subject do
    FactoryBot.create(:document)
  end

  it "has a valid factory" do
    expect(subject).to be_valid
    sections = subject.sections
    expect(sections[0].section_number).to eq('-')
  end


  # url is user input - what if its formatted wrong?

  describe '#clean_url' do

    it "replaces https:// and http:// with public/storage/" do
      expect(FactoryBot.build(:document, url: 'http://www.coe.int/t').clean_url).to eq('public/storage/www.coe.int/t')
      expect(FactoryBot.build(:document, url: 'https://www.coe.int/t').clean_url).to eq('public/storage/www.coe.int/t')
    end

  end


  describe '#url_text' do

    it "replaces '.pdf' or '' at the end of the url with .txt" do
      expect(FactoryBot.build(:document, url: 'http://www.coe.int/t.pdf').url_text).to eq('public/storage/www.coe.int/t.txt')
      expect(FactoryBot.build(:document, url: 'https://www.coe.int/t').url_text).to eq('public/storage/www.coe.int/t.txt')
    end

  end

  describe '#finish_parsing!' do

    it "sets status to 2" do
      document = FactoryBot.build(:document, status: 0)
      expect(document.status).to eq(0)
      document.finish_parsing!
      expect(document.status).to eq(2)
    end

  end

  #after create
  describe '#download_and_set_url_local' do

    it "creates a folder based on the url" do
      skip("unimplemented - file")
    end

    it "raises an error if the url fetches nothing" do
      expect { expect(FactoryBot.build(:document, url: 'https://rosan.co.uk/').download_and_set_url_local)}.to raise_error
    end

    it "raises an error if the url is html" do
      url = 'https://rm.coe.int/CoERMPublicCommonSearchServices/documentAccessError.jsp?url=http://rm.coe.int:80/CoERMPublicCommonSearchServices/sso/SSODisplayDCTMContent?documentId=09000016805d4b12'
      expect { FactoryBot.build(:document, url: url).download_and_set_url_local}.to raise_error
      expect { FactoryBot.build(:document, url: 'rpaige.co.uk').download_and_set_url_local}.to raise_error
    end


    it "downloads the file if the url has a pdf" do
      skip("unimplemented - file")
    end

    it "updates the url_local" do
      skip("unimplemented - private")
      # expect(FactoryBot.build(:document).url_local).to eq(nil)
      # expect(FactoryBot.build(:document).download_and_set_url_local).to eq('public/storage/www.coe.int/t/dg4/education/minlang/Report/EvaluationReports/UKECRML1_en.pdf')

    end

  end

    describe '#delete_local_documents' do
      pending("file")
    end

    describe '#language_parse(id)' do

      it "fetches a document given a valid id" do
        skip("unimplemented")
      end

      it "returns an error given an invalid id" do
        skip("unimplemented")
      end

      it "recreates all section-language associations by running language_parser_job" do
        skip("unimplemented - async")
      end

    #   TODO: what happens to the old associations?
    #   TODO:notice is a controller test
    end

    describe '#resection_document(id)' do

      it "fetches a document given a valid id" do
        skip("unimplemented")
      end

      it "returns an error given an invalid id" do
        skip("unimplemented")
      end

      it "destroys and recreates all sections by running section_document_job" do
        skip("unimplemented - async")
      end
      #   TODO:notice is a controller test
    end

    describe '#remove_sections' do

      it "removes sections not named 'Full Content'" do

        expect { [subject.remove_sections, subject.reload] }.to change{subject.sections.length}.from(3).to(2)

      end
    end


    describe '#reconstruct_sections(params)' do

      it "invalid params" do
        skip("unimplemented functionality")
      end

      it "builds sections with content less than 30000 characters" do

        language1 = FactoryBot.create(:language)
        language2 = FactoryBot.create(:language)
        language3 = FactoryBot.create(:language)

        params = {
            section_number: {'0' => ['1.1'], '1' => ['1.2']},
            section_name:  {'0' => ['section 1 name'], '1' => ['section 2 name']},
            page_number:  {'0' => ['5'], '1' => ['10']},
            content:  {'0' => ['lorem ipsum'], '1' => ['dorem incate']},
            language_id: {'1' => [language1.id.to_s, language2.id.to_s, language3.id.to_s]},
            strength: {'1' => [1,1,1]},
            id: subject.id.to_s
        }

        expect { [subject.reconstruct_sections(params), subject.reload] }.to change{subject.sections.length}.from(3).to(5)

      end

      it "builds sections with content more than 30000 characters" do

        params = {
            section_number: {'0' => ['1.1']},
            section_name:  {'0' => ['section 1 name']},
            page_number:  {'0' => ['5']},
            content:  {'0' => [content1+content2]},
            id: subject.id.to_s
        }

        expect { [subject.reconstruct_sections(params), subject.reload] }.to change{subject.sections.length}.from(3).to(5)

      end

    end

end




#   validates :url, presence: true
#   validates :country_id, presence: true
#   validates :document_type, presence: true, numericality: true, inclusion: { in: (0...DOCUMENT_TYPES.length).to_a }
#   validates :year, presence: true, numericality: true
#   validates :cycle, presence: true, numericality: true
